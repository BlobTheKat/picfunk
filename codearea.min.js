{const e=CSS.supports("-webkit-backdrop-filter","none"),t=new Map,i=new CSSStyleSheet,s=new CSSStyleSheet;s.insertRule("code-area{user-select:none !important;-webkit-user-select:none !important;position:relative !important;tab-size:2;box-sizing:border-box !important;-webkit-tap-highlight-color:#0000 !important;text-size-adjust: none !important;-webkit-text-size-adjust: none !important;touch-action: pan-y !important;display:grid !important;white-space:pre-wrap !important;font-family:monospace;overflow-wrap:break-word;overflow:auto !important;line-height:1.2;scrollbar-width:0;--max-line-width:100%;grid-template-columns:minmax(auto,var(--max-line-width));--min-gutter:0}",0),s.insertRule("code-area::-webkit-scrollbar{display: none}",1),document.adoptedStyleSheets.push(s),i.insertRule("textarea{z-index:1;padding:0;padding-left:max(1ch,var(--min-gutter) * 1ch);margin:0;inset:0;border:none;outline:none;background:none;font:inherit;color:#0000;resize:none;caret-color:#999;white-space:pre-wrap;tab-size:inherit;box-sizing:border-box;-webkit-tap-highlight-color:#0000;text-size-adjust: none;-webkit-text-size-adjust: none;touch-action:pan-y;overflow-wrap:inherit;overflow:clip;grid-area:1/1}",0),i.insertRule("textarea::selection{background: Highlight}",1),i.insertRule("div{min-height:1lh}",2),i.insertRule("label{box-sizing:border-box;position:absolute;left:0;width:calc(var(--g) + 0.25lh);display:block;white-space:pre;color:#808080;padding-right:0.25lh;clip-path:polygon(0 0, calc(100% - 0.25lh) 0, 100% 50%, calc(100% - 0.25lh) 100%, 0 100%);z-index:2;cursor:pointer;counter-increment:l}",3),i.insertRule("label::before{content:counter(l);display:inline-block;width:var(--g);text-align:right}",4),i.insertRule("main{grid-area:1/1;--g:max(1ch,var(--min-gutter) * 1ch);padding-left:var(--g)}",5),i.insertRule("label[data-message]:hover::after{content:attr(data-message);display:inline-block;padding-left:0.5lh;white-space:pre-wrap;vertical-align:top;width:calc(100% - var(--g) - 0.25lh)}",6),i.insertRule("label[data-message]:hover{width:100%;z-index:3;padding:var(--hover-padding)}",7);const n=document.createElement("p");globalThis.CodeAreaStyle=e=>{if("object"==typeof e&&(Object.assign(n.style,e),e=n.getAttribute("style"),n.style=""),"."==e[0])return e;let s=t.get(e);return void 0===s&&(t.set(e,s=Symbol.for("c"+t.size)),i.insertRule(`.${s.description}{${e}}`,t.size+2)),s},customElements.define("code-area",globalThis.CodeAreaElement=class t extends HTMLElement{static observedAttributes=(document.addEventListener("selectionchange",(()=>{const e=document.activeElement;e instanceof t&&e&&(e.#e=e.#t.selectionStart,e.#i=e.#t.selectionEnd)})),["value","disabled"]);#s=[];#n="";#l=null;#a=1;get firstLine(){return this.#a}set firstLine(e){this.#a=Math.floor(+e||0),this.#o.style.counterReset="l "+(this.#a-1)}get visibleLineCount(){return.5*this.#o.childNodes.length}get defaultLineStyle(){return this.#l}set defaultLineStyle(e){const t=this.#n;if(this.#n=e=(this.#l="symbol"==typeof e?e:null)?e.description:"",e==t)return;const i=this.#o.childNodes;for(let s=i.length-2;s>=0;s-=2){const n=i.item(s).classList;t?e?n.replace(t,e):n.remove(t):e&&n.add(e)}}setLineStyle(e,t=null,i=null){t="symbol"==typeof t?t.description:this.#n;const s=this.#o.childNodes.item(2*Math.floor(e-this.#a));return!!s&&(s.className=t,"string"==typeof i?s.dataset.message=i:delete s.dataset.message,!0)}resetAllLineStyles(){const e=this.#o.childNodes;for(let t=e.length-2;t>=0;t-=2){const i=e.item(t);i.className=this.#n,"string"==typeof message?i.dataset.message=message:delete i.dataset.message}}getLineStyle(e=0){const t=this.#o.childNodes.item(2*Math.floor(e-this.#a))?.classList;return t&&t.length?Symbol.for(t.item(0)):null}getLineMessage(e=1){const t=this.#o.childNodes.item(2*Math.floor(e-this.#a));return t?t.dataset.message??null:null}onlineclick=null;get basePattern(){return this.#s}set basePattern(e){this.#s=Array.isArray(e)?e:[],this.rehighlight()}#r=this.attachShadow({mode:"closed"});#o=document.createElement("main");#t=document.createElement("textarea");#c=0;#h=0;#e=0;#i=0;#d=0;submitChangeEvent=()=>{this.#c||(this.#c=requestAnimationFrame((()=>{this.#c=0,this.onchange?.call(this,this.#t.value)})))};cancelChangeEvent(){this.#c>=0&&(cancelAnimationFrame(this.#c),this.#c=0)}onchange=null;get disabled(){return this.#t.disabled}set disabled(e){this.#t.disabled=e}get value(){return this.#t.value}set value(e){this.#t.value=e,this.rehighlight(),this.submitChangeEvent()}get selectionStart(){return this.#t.selectionStart}get selectionEnd(){return this.#t.selectionEnd}set selectionStart(e){this.#e=this.#t.selectionStart=e}set selectionEnd(e){this.#i=this.#t.selectionEnd=e}get selectionAnchor(){return"backward"==this.#t.selectionDirection?this.selectionEnd:this.#t.selectionStart}get selectionFocus(){return"backward"==this.#t.selectionDirection?this.selectionStart:this.#t.selectionEnd}set selectionAnchor(e){const t=this.#t,i="backward"==t.selectionDirection,s=i?this.selectionStart:t.selectionEnd;e>s?(t.selectionEnd=e,i||(t.selectionDirection="backward",t.selectionStart=s)):(t.selectionStart=e,i&&(t.selectionDirection="forward",t.selectionEnd=s))}set selectionFocus(e){const t=this.#t,i="backward"==t.selectionDirection,s=i?this.selectionEnd:t.selectionStart;e>s?(t.selectionEnd=e,i&&(t.selectionDirection="forward",t.selectionStart=s)):(t.selectionStart=e,i||(t.selectionDirection="backward",t.selectionEnd=s))}#u(e,t,i){const s=this.#t.value;let n=0,l=1,a=1,o=0;const r=this.#o.childNodes,c=r.length-1;let h,d=r.item(1),u=null,g=0,m=null,f=null;if(c<0){const t=d=document.createElement("div");t.setAttribute("inert","");const i=document.createElement("label");this.#n&&i.classList.add(this.#n),t.append(""),t.stack=[this.#s],f=[this.#s],e=t.l=0,h=t.childNodes,this.#o.append(i,t)}else for(;l<=c;l+=2){d=r.item(l);let t=d.l+(l==c);if((n+=t)<e)continue;n-=t,h=d.childNodes;let i=h.length-1;if(i&&n+h.item(1).l>e&&l>1)do{t=(d=r.item(l-=2)).l,n-=t,h=d.childNodes,i=h.length-1}while(i<1&&l>1);f=d.stack.slice();let s=h.item(1),o=n,u=0,g=1;if(a=1,i)for(;;){const t=h.item(g).l;if(g==i||n+t>e)break;if(t){for(;o<n;){if(o+=s.l,s.f){let e=s.textContent;if(g==i){let t,i=l;do{t=r.item(i+=2).childNodes,e+="\n",e+=t.item(0).textContent}while(t.length<=1)}const t=f[f.length-1];s.f(f,e),f.length||f.push(t)}s=s.nextSibling,a++}n+=u=t}g++}e=n-u;break}u=f[f.length-1],g=u.length-1,m=1&u.length?u[g]:null,o=Math.min(this.#d-t,s.length-i),n=o+e,o=this.#d-n,n=(this.#d=s.length)-n;let p=h.item(a);const b=f.slice(),y=(e,t)=>{let i=null;"function"==typeof t&&(t=(i=t)(f,e),f.length||f.push(u),u!=(u=f[f.length-1])&&(g=u.length-1,m=1&u.length?u[g]:null));let s,n=e,o=e.indexOf("\n"),r=e.length;for(o>=0&&(n=e.slice(0,o),e=e.slice(o+1)),t?(s=document.createElement("span"),s.append(n),"symbol"==typeof t?s.classList.add(t.description):"string"==typeof t?s.style=t:"object"==typeof t&&Object.assign(s.style,t)):s=n?document.createTextNode(n):document.createComment(""),s.l=r,s.f=i,d.l+=r,d.insertBefore(s,p),a++;o>=0;){let i,c;if(o=e.indexOf("\n"),o>=0?(n=e.slice(0,o),e=e.slice(o+1)):(n=e,r=-1),t?(s=document.createElement("span"),s.append(n),"symbol"==typeof t?s.classList.add(t.description):"string"==typeof t?s.style=t:"object"==typeof t&&Object.assign(s.style,t)):s=n?document.createTextNode(n):document.createComment(""),x.length)({0:c,1:i}=x.splice(0,2)),i.firstChild.replaceWith(s),i.stack=f.slice();else{i=document.createElement("div"),i.setAttribute("inert",""),c=document.createElement("label"),this.#n&&c.classList.add(this.#n),i.append(s);let e=0;for(this.#o.insertBefore(i,d.nextSibling),this.#o.insertBefore(c,i);h.length>a;){const t=h.item(a);i.append(t),e+=t.l,d.l-=t.l}i.stack=f.slice(),i.l=e}h=(d=i).childNodes,l+=2,p=h.item(a=1)}},x=[],S=()=>{for(;o>0;){let e=null;if(p)d.l-=p.l;else{if(!x.length)break;if(e=x[x.length-1],p=e.childNodes.item(1),!p)break;e.l-=p.l}o-=p.l,p.remove();let t=p.textContent,i=p.f;if(e?1==e.childNodes.length:a==h.length){let e,s=l+x.length;for(;(e=r.item(s+2))&&(x.push(r.item(s+1),e),s+=2,i&&(t+="\n",t+=e.childNodes.item(0).textContent),!(e.childNodes.length>1)););p=void 0}else p=e?void 0:h.item(a);i&&i(b,t)}};S(),o-=n;let v=0;e:for(;e<s.length;){for(let t=0;t<g;t+=2){const i=u[t];let n=0;if("string"==typeof i){if(!i.includes(s[e]))continue;for(;i.includes(s[e+ ++n]););o+=n,S()}else if(i instanceof RegExp){if(i.lastIndex=e,!i.test(s))continue;if(n=i.lastIndex-e,!n&&!i.flags.includes("y")){console.error("Regex %s doesn't have the y flag",i);continue}o+=n,S()}if(v&&y(s.slice(e-v,e),m),y(s.slice(e,e+=n),u[t+1]),v=0,o)continue e;const l=f.length;if(l!=b.length)continue e;for(let e=l-1;e>=0;e--)if(f[e]!=b[e])continue e;break e}v++,e++,o++}if(v&&(o+=v,S(),y(s.slice(e-v),m)),x.length){const e=x[x.length-1].childNodes;for(const e of x)e.remove();for(;e.length>1;){const t=e.item(1);d.insertBefore(e.item(1),p),d.l+=t.l}}const w=Math.floor(Math.log10(Math.max(-this.#a,.5*r.length+this.#a-1)))+1.5;this.#o.style.setProperty("--g",this.#t.style.paddingLeft=`max(var(--min-gutter) * 1ch,${w}ch)`)}insert(e,t=this.#t.selectionStart,i=this.#t.selectionEnd,s=void 0){this.#t.setRangeText(e,t,i,"boolean"==typeof s?s?"end":"start":"preserve"),this.#u(t,i,t+e.length)}select(e,t=e){const i=Math.min(e,t);this.#t.setSelectionRange(this.#e=i,this.#i=e+t-i,i==e?"forward":"backward")}static TAB_OVERRIDE=(e,t,i,s,n)=>{e===t?s.insert("\t",e,t,!0):s.insert(n.shiftKey?i.replace(/\n\t/g,"\n"):i.replace(/\n/g,"\n\t"))};keyOverrides=(new Map).set("Tab",t.TAB_OVERRIDE);constructor(){super(),this.#r.adoptedStyleSheets.push(i),this.#r.appendChild(this.#o),this.#r.append(this.#t),this.#t.spellcheck=!1,this.#t.onchange=this.submitChangeEvent,this.#t.onkeydown=e=>{if(13===e.keyCode&&e.shiftKey)return this.#c||this.submitChangeEvent(),!1;const t=this.#t.selectionStart,i=this.#t.selectionEnd,s=this.#t.value.slice(t,i);let n=e.key;1==n.length&&(n=n.toUpperCase());const l=n;e.shiftKey&&"Shift"!=l&&(n="Shift+"+n),e.altKey&&"Alt"!=l&&(n="Alt+"+n),(e.ctrlKey||e.metaKey)&&"Control"!=l&&"Meta"!=l&&(n="Ctrl+"+n);const a=this.keyOverrides.get(n)??this.keyOverrides.get(l);a&&(a(t,i,s,this,e)||e.preventDefault())},this.#t.oninput=t=>{const i=this.#t,s=i.selectionStart;if("insertCompositionText"==t.inputType){const e=t.data,n=s-e.length;i.value.slice(n,s)==e&&this.#e>n&&(this.#e=n)}this.#u(Math.min(this.#e,this.#e=i.selectionStart),this.#i,this.#i=s),e&&(i.style.display="none",i.offsetWidth,i.style.display="")},this.#o.onclick=e=>{const t=e.composedPath()[0];if(!(t instanceof HTMLLabelElement))return;const i=this.#o.childNodes,s=i.length;for(let e=0;e<s;e++)if(i.item(2*e)==t){this.onlineclick?.(e+this.#a,this);break}return!1}}attributeChangedCallback(e,t,i){"disabled"==e?this.disabled=null!=i:"value"==e&&(this.value=i)}rehighlight(){this.#h||(this.#h=requestAnimationFrame((()=>{this.#h&&(this.#h=0,this.#u(0,this.#d,this.#t.value.length))})))}})}