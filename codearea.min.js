{const e=new Map,t=new CSSStyleSheet,i=new CSSStyleSheet;i.insertRule("code-area{user-select:none !important;-webkit-user-select:none !important;position:relative !important;tab-size:2;box-sizing:border-box !important;-webkit-tap-highlight-color:#0000 !important;text-size-adjust: none !important;-webkit-text-size-adjust: none !important;touch-action: pan-y !important;display:grid !important;white-space:pre-wrap !important;font-family:monospace;overflow-wrap:break-word;overflow:auto !important;line-height:1.2;scrollbar-width:0;--max-line-width:100%;grid-template-columns:minmax(auto,var(--max-line-width));--min-gutter:0}",0),i.insertRule("code-area::-webkit-scrollbar{display: none}",1),document.adoptedStyleSheets.push(i),t.insertRule("textarea{z-index:1;padding:0;padding-left:max(1ch,var(--min-gutter) * 1ch);margin:0;inset:0;border:none;outline:none;background:none;font:inherit;color:#0000;resize:none;caret-color:#999;white-space:pre-wrap;tab-size:inherit;box-sizing:border-box;-webkit-tap-highlight-color:#0000;text-size-adjust: none;-webkit-text-size-adjust: none;touch-action:pan-y;overflow-wrap:inherit;overflow:clip;grid-area:1/1}",0),t.insertRule("textarea::selection{background: #80808080}",1),t.insertRule("div{min-height:1lh;counter-increment:l}",2),t.insertRule("label{box-sizing:border-box;position:absolute;left:0;width:calc(var(--g) + 0.25lh);display:block;white-space:pre;color:#808080;padding-right:0.25lh;clip-path:polygon(0 0, calc(100% - 0.25lh) 0, 100% 50%, calc(100% - 0.25lh) 100%, 0 100%);z-index:2;cursor:pointer}",3),t.insertRule("label::before{content:counter(l);display:inline-block;width:var(--g);text-align:right}",4),t.insertRule("main{grid-area:1/1;--g:max(1ch,var(--min-gutter) * 1ch);padding-left:var(--g)}",5),t.insertRule("label[data-message]:hover::after{content:attr(data-message);display:inline-block;padding-left:0.5lh;white-space:pre-wrap;vertical-align:top;width:calc(100% - var(--g) - 0.25lh)}",6),t.insertRule("label[data-message]:hover{width:100%;z-index:3;padding:var(--hover-padding)}",7);const l=document.createElement("p");globalThis.CodeAreaStyle=i=>{if("object"==typeof i&&(Object.assign(l.style,i),i=l.getAttribute("style"),l.style=""),"."==i[0])return i;let s=e.get(i);return void 0===s&&(e.set(i,s=Symbol.for("c"+e.size)),t.insertRule(`.${s.description}{${i}}`,e.size+2)),s},customElements.define("code-area",globalThis.CodeAreaElement=class e extends HTMLElement{static observedAttributes=["value","disabled"];#e=[];#t="";#i=null;#l=1;get firstLine(){return this.#l}set firstLine(e){this.#l=Math.floor(+e||0),this.#s.style.counterReset="l "+(this.#l-1)}get visibleLineCount(){return this.#s.childNodes.length}get defaultLineStyle(){return this.#i}set defaultLineStyle(e){const t=this.#t;if(this.#t=e=(this.#i="symbol"==typeof e?e:null)?e.description:"",e!=t)for(const i of this.#s.childNodes){const l=i.firstChild.classList;t?e?l.replace(t,e):l.remove(t):e&&l.add(e)}}setLineStyle(e,t=null,i=null){t="symbol"==typeof t?t.description:this.#t;const l=this.#s.childNodes[e-this.#l]?.firstChild;return!!l&&(l.className=t,"string"==typeof i?l.dataset.message=i:delete l.dataset.message,!0)}resetAllLineStyles(){const e=this.#s.childNodes;for(let t=e.length-1;t>=0;t--){const i=e[t].firstChild;i.className=this.#t,"string"==typeof message?i.dataset.message=message:delete i.dataset.message}}getLineStyle(e=0){const t=this.#s.childNodes[e-this.#l]?.firstChild.classList;return t&&t.length?Symbol.for(t[0]):null}getLineMessage(e=1){const t=this.#s.childNodes[e-this.#l]?.firstChild;return t?t.dataset.message??null:null}onlineclick=null;get basePattern(){return this.#e}set basePattern(e){this.#e=Array.isArray(e)?e:[],this.rehighlight()}#n=this.attachShadow({mode:"closed"});#s=document.createElement("main");#a=document.createElement("textarea");#o=0;#r=0;#h=0;#c=0;#d=0;static#u=document.addEventListener("selectionchange",(()=>{const t=document.activeElement;t instanceof e&&t&&(t.#h=t.#a.selectionStart,t.#c=t.#a.value.length-t.#a.selectionEnd)}));compile=()=>{this.#o||(this.#o=requestAnimationFrame((()=>this.#g())))};cancelCompile(){this.#o<0||(cancelAnimationFrame(this.#o),this.#o=0)}oncompile=null;#g(){this.#o=0,this.oncompile?.call(this,this.#a.value)}get disabled(){return this.#a.disabled}set disabled(e){this.#a.disabled=e}get value(){return this.#a.value}set value(e){this.#a.value=e,this.rehighlight(),this.compile()}get selectionStart(){return this.#a.selectionStart}get selectionEnd(){return this.#a.selectionEnd}set selectionStart(e){this.#a.selectionStart=e}set selectionEnd(e){this.#a.selectionEnd=e}constructor(){super(),this.#n.adoptedStyleSheets.push(t),this.#n.appendChild(this.#s),this.#n.append(this.#a),this.#a.spellcheck=!1,this.#a.onchange=this.compile,this.#a.onkeydown=e=>{if(13===e.keyCode&&e.shiftKey)return this.#o||this.#g(),!1;if(9===e.keyCode){const t=this.#a.selectionStart,i=this.#a.selectionEnd,l=this.#a.value;return t===i?(this.#a.value=l.slice(0,t)+"\t"+l.slice(t),this.#a.selectionStart=this.#a.selectionEnd=t+1):(e.shiftKey?this.#a.value=l.slice(0,t)+l.slice(t,i).replace(/\n\t/g,"\n")+l.slice(i):this.#a.value=l.slice(0,t)+l.slice(t,i).replace(/\n/g,"\n\t")+l.slice(i),this.#a.selectionStart=t,this.#a.selectionEnd=i+this.#a.value.length-l.length),this.#a.oninput(),!1}},this.#a.oninput=e=>{if(this.#r){if("number"!=typeof e)return;this.#r=0}const t=this.#a.value;let i=Math.min(this.#h,this.#h=this.#a.selectionStart),l=0,s=0,n=2,a=0;const o=this.#s.children,r=o.length-1;let h,c=o[0],d=null,u=0,g=null;const p=()=>{m.length?d!=(d=m[m.length-1])&&(u=d.length-1,g=1&d.length?d[u]:null):m.push(d)};let m=null;if(r<0){const e=c=document.createElement("div"),t=document.createElement("label");this.#t&&t.classList.add(this.#t),e.append(t,""),e.stack=m=[this.#e],i=e.l=0,h=e.childNodes,this.#s.appendChild(e)}else for(;s<=r;s++){c=o[s];let e=c.l+(s==r);if((l+=e)<=i)continue;l-=e,h=c.childNodes;let t=h.length-1;if(t>1&&l+h[2].l>i&&s)do{e=(c=o[--s]).l,l-=e,h=c.childNodes,t=h.length-1}while(t<2&&s);m=c.stack.slice();let a=null,d=0;if(n=2,t>1)for(;;){const e=h[n],r=e.l;if(n==t||l+r>i)break;if(l+=d=r,a?.f){let e=a.textContent;if(n==t){let t,i=s;do{t=o[++i].childNodes,e+="\n",e+=t[1].textContent}while(t.length<=2)}a.f(m,e)}a=e,n++}i=l,n>2&&(i-=d,n--);break}p(),a=Math.min(this.#c,this.#c=t.length-this.#a.selectionEnd),l=a,a=this.#d-l-i,l=(this.#d=t.length)-l-i;let f=h[n];const b=m.slice(),x=(e,t)=>{let i=null;"function"==typeof t&&(t=(i=t)(m,e),p());let l,a=e,o=e.indexOf("\n"),r=e.length;for(o>=0&&(a=e.slice(0,o),e=e.slice(o+1)),t?(l=document.createElement("span"),l.append(a),"symbol"==typeof t?l.classList.add(t.description):"string"==typeof t?l.style=t:"object"==typeof t&&Object.assign(l.style,t)):l=a?document.createTextNode(a):document.createComment(""),l.l=r,l.f=i,c.l+=r,c.insertBefore(l,f),n++;o>=0;){o=e.indexOf("\n"),o>=0?(a=e.slice(0,o),e=e.slice(o+1)):(a=e,r=-1),t?(l=document.createElement("span"),l.append(a),"symbol"==typeof t?l.classList.add(t.description):"string"==typeof t?l.style=t:"object"==typeof t&&Object.assign(l.style,t)):l=a?document.createTextNode(a):document.createComment("");const i=document.createElement("div"),d=document.createElement("label");this.#t&&d.classList.add(this.#t),i.append(d,l);let u=0;for(this.#s.insertBefore(i,c.nextSibling);h.length>n;){const e=h[n];i.append(e),u+=e.l,c.l-=e.l}i.stack=m.slice(),i.l=u,h=(c=i).childNodes,f=h[n=2],s++}},y=()=>{for(;f&&a>0;){c.l-=f.l,a-=f.l,f.remove();let e=f.textContent,t=f.f;if(n==h.length){let i;for(;(i=o[s+1])&&(i.remove(),t&&(e+="\n",e+=i.childNodes[1].textContent),!(i.childNodes.length>2)););if(i){const e=i.childNodes;for(;e.length>2;){const t=e[2];c.append(t),c.l+=t.l}}}t&&t(b,e),f=h[n]}};y(),a-=l;let S=0;e:for(;i+S<t.length;){for(let e=0;e<u;e+=2){const l=d[e];if(l.lastIndex=i+S,!l.test(t))continue;const s=l.lastIndex-i;if(s||l.flags.includes("y")){a+=s,S&&x(t.slice(i,i+S),g),x(t.slice(i+S,i+=s),d[e+1]),y(),S=0;t:if(!a){const e=m.length;if(e!=b.length)break t;for(let t=e-1;t>=0;t--)if(m[t]!=b[t])break t;const t=Math.floor(Math.log10(o.length))+1.5;return void this.#s.style.setProperty("--g",this.#a.style.paddingLeft=`max(var(--min-gutter) * 1ch,${t}ch)`)}continue e}console.error("Regex %s doesn't have the y flag",l)}S++}a+=S,y(),i<t.length&&x(t.slice(i),g);const v=Math.floor(Math.log10(o.length))+1.5;this.#s.style.setProperty("--g",this.#a.style.paddingLeft=`max(var(--min-gutter) * 1ch,${v}ch)`)},this.#s.onclick=e=>{const t=e.composedPath()[0];if(!(t instanceof HTMLLabelElement))return;const i=this.#s.childNodes,l=i.length;for(let e=0;e<l;e++)if(i[e].firstChild==t){this.onlineclick?.(e+this.#l,this);break}return!1}}attributeChangedCallback(e,t,i){"disabled"==e?this.disabled=null!=i:"value"==e&&(this.value=i)}rehighlight(){if(this.#r)return;this.#h=this.#c=0;const e=this.#s.children;let t=e.length;for(;t>1;)e[--t].remove();this.#r=requestAnimationFrame(this.#a.oninput)}})}
